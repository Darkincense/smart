<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>中国石油装备制造IOT系统 | 登录</title>

    <meta name="description" content="User login page" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="static/thingsboard.ico" />
    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="./c10/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./c10/assets/font-awesome/css/font-awesome.min.css" />

    <!-- text fonts -->
    <link rel="stylesheet" href="./c10/assets/css/fonts.googleapis.com.css" />

    <!-- ace styles -->
    <link rel="stylesheet" href="./c10/assets/css/ace.min.css" />

    <link rel="stylesheet" href="./c10/assets/css/ace-rtl.min.css" />


    <style>
		.login-box{
			position:absolute;
			top:50%;
			transform: translateY(20%) !important;
			-ms-transform: translateY(20%);
			-moz-transform: translateY(20%);
			-webkit-transform: translateY(20%);
			-o-transform: translateY(20%);
		}
        .login-box .toolbar { 
            padding: 0 10px;
        }
		.login-box h1,h2,h3,h4,h5,h6{
			font-family: Microsoft yahei,sans-serif;
		}
        
        .codediv {
            width: 40%;
            padding-left: 10px;
        }
        
        .toolbar-top {
            margin-top: 3px;
        }
        
        .login_code {
            background-color: #fff;
            border: 1px solid #ccc;
            -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
            -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
            -webkit-transition: border linear .2s, box-shadow linear .2s;
            -moz-transition: border linear .2s, box-shadow linear .2s;
            -o-transition: border linear .2s, box-shadow linear .2s;
            transition: border linear .2s, box-shadow linear .2s;
        }
        
        .login-btn,
        .cancel-btn {
            border: none;
			width: 100%;
			padding: 12px  10px !important;
			background: -webkit-linear-gradient(top,#4585ef,#4c6cdf) !important;
			background: -moz-linear-gradient(top,#4585ef,#4c6cdf) !important;
			background: linear-gradient(top,#4585ef,#4c6cdf) !important;
			-webkit-border-radius: 3px;
			   -moz-border-radius: 3px;
			        border-radius: 3px;
        }
        
        .login-layout .login-box .widget-main {
            padding-bottom: 0px;
        }
        
        .white {
            font-size: 20px;
            font-weight: 300;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
        
        .center h1 img {
            width: 30px;
        }
        
        fieldset {
            position: relative;
        }
        
        .pshow {
            position: absolute;
            color: red;
        }
		.pshow,.form-control,.btn{font-family:Microsoft Yahei,sans-serif !important;}
		.form-control::-webkit-input-placeholder{font-family:Microsoft Yahei,sans-serif;}
		.form-control::-moz-input-placeholder{font-family:Microsoft Yahei,sans-serif;}
		.form-control::-ms-input-placeholder{font-family:Microsoft Yahei,sans-serif;}
		.margin-b{margin-bottom:20px;}
		.f-white a,.f-white span{color: #fff;}
    </style>
</head>

<body class="login-layout" id="particles-js" ng-app="myapp" ng-controller="ft">
    <div class="main-container">
        <div class="main-content">
			<div class="row">
				<div class="col-sm-4">
				<div class="space-6"></div>
					<div class="center">
											<img src="./c10/pages/iotc10small.png" alt="中国石油装备制造IOT系统" id="id-text2">
											
										</div>
				</div>
			</div>
            <div class="row" style="z-index:9999;">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="login-container">
                       


                        <div class="position-relative">
                            <div id="login-box" class="login-box visible widget-box no-border">
                                <div class="widget-body">
                                    <div class="widget-main">
										<div class="space-6"></div>
										 <div class="center">
											<h3 id="id-text2">中国石油装备制造IOT系统</h3>
											
											 <h5>
												欢迎您，请登录
											</h5>
										</div>
                                       

                                        <div class="space-6"></div>

                                        <form ng-keyup="myKeyUp($event)">
                                            <fieldset>
                                                <label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" placeholder="用户名" ng-model="myname" />
															<i class="ace-icon fa fa-user"></i>
														</span>
													</label>
												
                                                <label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="密码" ng-model="mypas" ng-keyup="enterEvent($event)"/>
															<i class="ace-icon fa fa-lock"></i>
														</span>
													</label>
												<div class="center">
													<p class="pshow" ng-show="loginshow">{{content}}</p>
                                                </div>
                                            </fieldset>
                                        </form>


                                        <div class="space-6"></div>
										
										 <div class="center margin-b">
                                            <button ng-click="go()" type="button" class="btn login-btn flip-link  btn-info">
												<span id="login" class="bigger-110">登&nbsp;&nbsp;录</span>
											</button>
											<!--
                                            <button type="button" class="cancel-btn btn btn-success">
												<span class="bigger-110">取消</span>
											</button>
											-->
                                        </div>
										  <div class="space-6"></div>
                                    </div>
                                    <!-- /.widget-main -->
                                </div>
                                <!-- /.widget-body -->
                            </div>
                            <!-- /.login-box -->

                        </div>
                        <!-- /.position-relative -->

						<!--
                        <div class="navbar-fixed-top align-right f-white">
                            <br /> &nbsp;
                            <a id="btn-login-dark" href="#">Dark</a> &nbsp;
                            <span>/</span> &nbsp;
                            <a id="btn-login-blur" href="#">Blur</a> &nbsp;
                            <span>/</span> &nbsp;
                            <a id="btn-login-light" href="#">Light</a> &nbsp; &nbsp; &nbsp;
                        </div>
						-->
                    </div>
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>

        <!-- /.main-content -->
    </div>
    <!-- /.main-container -->

    <!-- basic scripts -->

    <!--[if !IE]> -->
    <script src="./c10/bower_components/jquery/dist/jquery.min.js"></script>

    <!-- <![endif]-->
    <script src="./c10/bower_components/angular/angular-1.6.6.js"></script>
    <!--[if IE]>
<script src="assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
    <script src="./c10/js/base.js"></script>
    <script src="./c10/js/particles.js"></script>
    <script>
        particlesJS.load('particles-js', './c10/js/particles.json', function() {
            console.log('callback - particles.js config loaded');
        });
    </script>
    <script type="text/javascript">
        if ('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>

    <!-- inline scripts related to this page -->
    <script type="text/javascript">
        //you don't need this, just used for changing background
        jQuery(function($) {
            $('#btn-login-dark').on('click', function(e) {
                $('body').attr('class', 'login-layout');
                $('#id-text2').attr('class', 'white');
                $('#id-company-text').attr('class', 'blue');
                e.preventDefault();
            });
            $('#btn-login-light').on('click', function(e) {
                $('body').attr('class', 'login-layout light-login');
                $('#id-text2').attr('class', 'grey');
                $('#id-company-text').attr('class', 'blue');
                e.preventDefault();
            });
            $('#btn-login-blur').on('click', function(e) {
                $('body').attr('class', 'login-layout blur-login');
                $('#id-text2').attr('class', 'white');
                $('#id-company-text').attr('class', 'light-blue');
                e.preventDefault();
            });
        });

        function baseLocalStorage(name) {
            var base = new Base64();
            var cookietwo = localStorage.getItem(name).split('.')[1];
            var str = base.decode(cookietwo);
            str = str.slice(0, (str.indexOf("}") + 1));
            return JSON.parse(str);
        }
        var app = angular.module('myapp', []);
        app.controller('ft', function($scope, $http) {
            $scope.myname = '';
            $scope.mypas = '';
            $scope.loginshow = false;
            $scope.content = "";
            $scope.myKeyup = function(e) {
                console.log(e);
                var keycode = window.event ? e.keyCode : e.which;
                if (keycode == 13) {
                    console.log("aaa")
                }
            };
            $scope.go = function() {
                $http({
                    method: "POST",
                     url: "./api/auth/login",
                  //  url: "/c10/api/auth",
                    parmas: '',
                    data: {
                        "username": $scope.myname,
                        "password": $scope.mypas
                    }
                }).
                then(function success(data) {
                        if (data.status == 200) {
                            $scope.myStatus = data.status;
                            localStorage.setItem("jwt_token", '"' + data.data.token + '"');
                            var jwtToken = baseLocalStorage("jwt_token");
                            var ttl = jwtToken.exp - jwtToken.iat;
                            var ttl = jwtToken.exp;
                            localStorage.setItem("jwt_token_expiration", new Date().valueOf() + ttl * 1000);
                            localStorage.setItem("refresh_token", '"' + data.data.refreshToken + '"');
                            var refreshToken = baseLocalStorage("refresh_token");
                            var tpl = refreshToken.exp - refreshToken.iat;
                            localStorage.setItem("refresh_token_expiration", new Date().valueOf() + tpl * 1000);
                            location.href = 'index.html';
                        }

                    },
                    function error(resp) {
                        if (resp.data.status == 401) {
                            $scope.content = "认证失败，请输入正确的用户名和密码";
                            $scope.loginshow = true;
                        } else {
                            $scope.content = "服务器内部异常";
                            $scope.loginshow = true;
                        }
                    })
            };
            $scope.enterEvent = function(e) {
                var keycode = window.event ? e.keyCode : e.which;
                if (keycode == 13) {
                    $scope.go();
                }
            }
        })
    </script>
</body>

</html>